# Rétrospective Epic 3 — Le Gestionnaire de Deck (Persistance & Multi-Console)

**Date :** 2026-02-13  
**Epic :** 3 — Le Gestionnaire de Deck  
**FR couverts :** FR4, FR5, FR6  
**Stories :** 4/4 done (3.0 Auth, 3.1 UI Deck, 3.2 Persistance locale, 3.3 Sync cloud)  
**Facilitateur :** Bob (Scrum Master)  
**Participants :** Julien (Project Lead), équipe Dev, Quinn (QA)

---

## 1. Contexte et périmètre

- **Objectif Epic 3 :** Permettre de gérer jusqu’à 3 configurations (deck) avec persistance locale (invités) et synchronisation cloud (utilisateurs authentifiés).
- **Rétrospective précédente :** Epic 2 (epic-2-retro-2026-02-11.md) — 4 action items et tâches de préparation Epic 3.
- **Épic suivante :** Epic 4 — L’Expérience Signature (Showcase & Validation finale) ; déjà en cours (4.1 et 4.2 done).

---

## 2. Analyse des stories (synthèse)

### 2.1 Story 3.0 — Authentification simple (Email/Password)

- **Livrables :** Tables `users` / `user_configurations` (migration 009), hash Argon2, JWT en cookie HttpOnly, `POST /auth/register`, `POST /auth/login`, `GET /auth/me`, middleware `AuthUser`, `AppState` avec `catalog` + `pool`, tests d’intégration auth.
- **Points forts :** Fondation solide pour 3.1/3.3 ; séparation claire logic/auth, data/auth_repo, handlers ; CORS et credentials configurés pour le frontend.
- **Note :** Pas de rapport QA dédié ; les tests sont dans `auth_integration_tests.rs` (5 tests avec `--ignored` + DB).

### 2.2 Story 3.1 — L’UI du Deck (Multi-Cartes)

- **Livrables :** Store Pinia `deck` (configurations, addCurrentConfig, removeConfig, canAddMore), composant `DeckManager.vue`, bouton MON_DECK dans le HUD, cartes avec aperçu coque, nom, prix, limite 3.
- **Points forts :** Store dédié sans surcharger le configurator ; style cohérent (glass, neon) ; pas d’API en 3.1 comme prévu.
- **QA :** Rapport Quinn (test-summary-story-3-1) ; E2E deck-manager + unitaires deck.spec.js.

### 2.3 Story 3.2 — Persistance locale & logique de synchronisation

- **Livrables :** `pinia-plugin-persistedstate` activé, store deck avec `persist: { key: 'gameboy-deck' }`, restauration après reload, aucun appel API.
- **Points forts :** Changement minimal (main.js + option persist) ; code review avec 1 écart Git, 4 LOW, tous corrigés.
- **Note :** Pas de rapport QA dédié ; couverture via deck-manager.spec.js (reload, restauration).

### 2.4 Story 3.3 — Synchronisation cloud & optimisation VPS CX11

- **Livrables :** `GET /deck`, `POST /deck`, `DELETE /deck/:id`, `deck_repo.rs`, limite 3 (trigger 009), sync conditionnelle (connecté → API, invité → localStorage), tests intégration backend + E2E sync.
- **Points forts :** JSONB compact, index user_id, pas de N+1 ; persistance hybride documentée ; 409 explicite pour limite 3.
- **QA :** Rapport Quinn (test-summary-story-3-3) ; deck_integration_tests.rs, deck-manager.spec.js.

### 2.5 Patterns transversaux

- **Ordre des stories :** 3.0 (auth) → 3.1 (UI) → 3.2 (local) → 3.3 (cloud) a évité les rework et gardé une dépendance claire.
- **Architecture :** Backend 3-tier (handlers → logic/data), frontend store deck séparé, API contracts respectés.
- **Qualité :** Zéro correctif appliqué pendant les validations QA (rapport Quinn) — code livré stable.

---

## 3. Rapport QA (intégration — source : test-summary-epic-3.md, Quinn 2026-02-13)

**Source :** Rapport QA Epic 3 — `tests/test-summary-epic-3.md` (Quinn, 2026-02-13). Synthèse ci-dessous alignée sur ce rapport.

### 3.1 Résumé exécutif

| Périmètre | Résultat | Détail |
|-----------|----------|--------|
| E2E Deck Manager (3.1, 3.2, 3.3) | ✅ 9 scénarios passés | deck-manager.spec.js (Chromium) |
| Unitaires store deck (3.1) | ✅ 8 tests passés | frontend/tests/unit/deck.spec.js |
| Intégration backend Auth (3.0) | ✅ 5 tests passés | auth_integration_tests.rs (`cargo test -- --ignored`) |
| Intégration backend Deck (3.3) | ✅ 5 tests passés | deck_integration_tests.rs (`cargo test -- --ignored`) |
| Correctifs pendant la QA | 0 | Aucune modification du code lors des validations QA |

**Statut QA Epic 3 :** ✅ **Validé** — 39+ tests exécutés, tous passants. Les 12 tests d’intégration backend nécessitent `DATABASE_URL_TEST` (ou `DATABASE_URL`) et `JWT_SECRET` dans `.env`.

### 3.2 Couverture par critères d’acceptation (rapport Quinn)

| Story | AC | Statut |
|-------|-----|--------|
| 3.0 | #1–#4 (inscription, login, JWT, endpoints protégés) | ✅ auth_integration_tests.rs |
| 3.1 | #1–#3 (cartes, limite 3, suppression) | ✅ deck-manager.spec.js, deck.spec.js |
| 3.2 | #1–#2 (restauration reload, persistance auto) | ✅ deck-manager.spec.js |
| 3.3 | #1–#4 (sync CRUD, GET au chargement, limite 409, invité localStorage) | ✅ deck_integration_tests.rs, deck-manager.spec.js |

### 3.3 Couverture des FR

| FR | Exigence | Couvert par les tests |
|----|----------|------------------------|
| FR4 | Deck multi-cartes (1–3 configs) | ✅ deck-manager, deck.spec, deck_integration_tests |
| FR5 | Sauvegarde panier (localStorage invités) | ✅ deck-manager (persistance locale, guest) |
| FR6 | Synchronisation cloud (utilisateurs connectés) | ✅ deck_integration_tests, deck-manager |

### 3.4 Recommandations (rapport Quinn)

1. **CI :** Pour exécuter les 12 tests d’intégration backend en CI : créer la base `gameboy_configurator_test`, configurer `DATABASE_URL_TEST` dans les secrets, puis `cargo test -- --ignored`.
2. **Mobile Chrome :** Un test 3.1 (limite 3 configurations) peut échouer sur Mobile Chrome (timeout/viewport). Non bloquant ; à traiter séparément si besoin.
3. **Rapports manquants :** Aucun rapport QA dédié pour Story 3.0 ni 3.2. Les tests existent et couvrent les AC ; une génération de rapports rétroactive est optionnelle pour homogénéité.

---

## 4. Suivi de la rétrospective Epic 2

| # | Action Epic 2 | Statut | Commentaire |
|---|----------------|--------|-------------|
| 1 | Aligner sprint-status (2-2 → done, epic-2 → done) | ✅ | État cohérent avant démarrage Epic 3 |
| 2 | Corriger le warning Vue sur le composant Tooltip | ⏳ | À vérifier si traité (non bloquant Epic 3) |
| 3 | Documenter l’exécution des tests API (backend requis / CI) dans README | ⏳ | Partiel : tests Epic 3 documentés dans rapport Quinn et README possible |
| 4 | Ajouter data-testid / ARIA sur ExpertSidebar / ExpertModCard | ⏳ | Réduction des correctifs QA Epic 2 ; Epic 3 n’a pas requis de correctifs locators |

**Tâches de préparation Epic 3 (rétro Epic 2) :** Migrations 009 (auth + deck) appliquées ; stratégie CI pour tests avec DB à renforcer (reco. Quinn ci-dessus). Première story Epic 3 (3.0) planifiée et livrée.

---

## 5. Aperçu Epic 4 et dépendances

- **Epic 4 :** « L’Expérience Signature » — Showcase & Validation finale (FR10). Déjà en cours : 4.1 (Moment signature, focus reveal) et 4.2 (Validation et transition panier) sont done.
- **Dépendances sur Epic 3 :** Auth (store auth, GET /auth/me, login, register), Deck (POST /deck pour synchro optionnelle), persistance locale et cloud en place. Epic 4 s’appuie sur ces briques pour le parcours signature et panier.
- **Préparation :** Aucun blocage identifié ; les livrables Epic 3 sont stables et couverts par la QA.

---

## 6. Ce qui a bien fonctionné

- **Ordre des stories 3.0 → 3.1 → 3.2 → 3.3 :** Fondation auth puis UI puis persistance locale puis cloud — peu de retours en arrière et dépendances claires.
- **Rapport QA Quinn :** Synthèse Epic 3 (test-summary-epic-3.md) avec tableau par story, AC, FR et recommandations CI/Mobile ; zéro correctif pendant la QA reflète une livraison stable.
- **Architecture backend :** AppState (catalog + pool), auth_repo / deck_repo, handlers protégés par AuthUser, migrations 009 appliquées au démarrage.
- **Store deck et persistance hybride :** Invité = localStorage (gameboy-deck), connecté = source de vérité backend ; stratégie documentée en 3.3.
- **Tests :** Couverture E2E (deck-manager), unitaires (deck.spec.js), intégration Rust (auth + deck) avec prérequis DB documentés.

---

## 7. Défis et axes d’amélioration

- **Rapports QA non homogènes :** Stories 3.0 et 3.2 n’ont pas de rapport QA dédié ; les tests couvrent les AC. Pour les prochaines epics, viser un rapport par story ou au minimum un rapport epic consolidé (comme pour Epic 3).
- **CI sans PostgreSQL :** Les 12 tests d’intégration backend sont ignorés par défaut (`#[ignore]`). Pour une QA complète en CI, il faut une base de test et `DATABASE_URL_TEST` (recommandation Quinn).
- **Mobile Chrome :** Un test deck (limite 3 configs) peut être fragile sur Mobile Chrome (timeout/viewport) ; à traiter si la cible mobile est prioritaire.
- **Action items Epic 2 partiellement ouverts :** Tooltip, documentation CI et data-testid restent des améliorations à capitaliser pour la suite.

---

## 8. Action items proposés

| # | Action | Responsable | Critère de succès |
|---|--------|-------------|-------------------|
| 1 | Documenter en README (ou CI) la procédure pour exécuter les tests d’intégration backend (DATABASE_URL_TEST, `cargo test -- --ignored`) | Dev / QA | Procédure claire pour QA et CI Epic 3+ |
| 2 | Optionnel : générer des rapports QA rétroactifs pour les stories 3.0 et 3.2 pour homogénéité avec 3.1/3.3 | QA | Rapports présents ou décision explicite de ne pas les faire |
| 3 | Poursuivre les action items Epic 2 non clos : Tooltip warning, data-testid/ARIA sur composants clés | Dev | Réduction des warnings et fragilité des locators E2E |
| 4 | Si cible mobile : investiguer et stabiliser le test « limite 3 configurations » sur Mobile Chrome | QA / Dev | Test vert sur Mobile Chrome ou marqué skip avec justification |

---

## 9. Préparation Epic 4 (déjà engagée)

- **État :** Epic 4 est en cours (4.1 et 4.2 done). Les briques Epic 3 (auth, deck, persistance) sont en place et validées par la QA.
- **Recommandation :** Continuer à s’appuyer sur le rapport QA et les patterns Epic 3 (store deck, sync conditionnelle, tests E2E + intégration) pour les stories restantes d’Epic 4.

---

## 10. Synthèse et clôture

- **Epic 3** est considérée comme **livrée** : 4 stories done (3.0, 3.1, 3.2, 3.3), revues et couvertes par les tests. Le rapport QA de Quinn (test-summary-epic-3.md) valide la couverture des AC et des FR, avec zéro correctif appliqué pendant la QA.
- **Points clés :** ordre des stories efficace, architecture auth/deck solide, persistance hybride claire, qualité livrée stable. À capitaliser : homogénéité des rapports QA par story, CI avec base de test pour les tests d’intégration backend.
- **Prochaine étape :** Clôturer la rétro Epic 3 (sprint-status : epic-3 → done, epic-3-retrospective → done), exécuter les action items ci-dessus en parallèle du travail Epic 4.

---

*Généré par : Bob (Scrum Master) — Workflow : Epic Retrospective [ER]*  
*Document : epic-3-retro-2026-02-13.md*  
*Rapport QA source : Quinn — test-summary-epic-3.md (2026-02-13)*
